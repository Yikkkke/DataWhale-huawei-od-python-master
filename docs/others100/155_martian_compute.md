# 155 火星文计算

## 题目描述

已知火星人使用的运算符号为`#`、`$`，他们与地球人的等价公式如下：
- `x#y=4*x+3*y+2`
- `x$y=2*x+y+3`

其中`x`、`y`是无符号整数，地球人公式按照C语言规则进行计算，火星人公式中`#`符优先级高于`$`，相同的运算符按从左到右的顺序运算。

## 输入描述

火星人字符串表达式结尾不带回车换行。

输入的字符串说明：
1. 字符串为仅有无符号整数和操作符组成的计算表达式。
2. 用例保证字符串中操作数与操作符之间没有任何分隔符。
3. 用例保证操作数取值范围为32位无符号整数。
4. 保证输入以及计算结果不会出现整型溢出。
5. 保证输入的字符串为合法的求值报文，例如：`123#4$5#76$78`。
6. 保证不会出现非法的求值报文，例如：
    - `#4$5`这种缺少操作数。
    - `4$5#`这种缺少操作数。
    - `4#$5`这种缺少操作数。
    - `4 $5`有空格。
    - `3+4-5*6/7`有其他操作符。
    - `12345678987654321$54321` 32位整数溢出。

## 输出描述

根据火星人字符串输出计算结果，结尾不带回车换行。

## 示例描述

### 示例一

**输入：**
```text
7#6$5#12
```

**输出：**
```text
157
```

**说明：**
```text
7#6$5#12=(4*7+3*6+2)$5#12
        =48$5#12
        =48$(4*5+3*12+2)
        =48$58
        =2*48+58+3
        =157
```
所以，输出是157。

## 解题思路

1. 使用正则表达式，将数字和操作符存储在列表`chars`中。
2. 遍历列表：
   - 优先计算`#`操作，将计算结果替换相应列表的位置。
   - 没有`#`操作，再计算`$`操作，将计算结果替换相应列表的位置。
   - 如果只剩下一个元素，则已经计算完成，跳出循环。
3. 返回列表中剩下的那个元素，即火星文的计算结果。

## 解题代码

```python
import re


def sharp(x, y):
    return 4 * x + 3 * y + 2


def dollar(x, y):
    return 2 * x + y + 3


def solve_method(line):
    # 将数字和操作符存储在列表中
    chars = re.findall(r"(\d+)|([#$])", line)
    chars = [match[0] or match[1] for match in chars]
    chars = [int(x) if x.isdigit() else x for x in chars]

    while len(chars) != 1:
        pos = chars.index("#") if "#" in chars else -1
        if pos != -1:
            # 优先计算#操作
            tmp = sharp(chars[pos - 1], chars[pos + 1])
            chars[pos - 1:pos + 2] = [tmp]
        else:
            pos = chars.index("$") if "$" in chars else -1
            if pos != -1:
                # 再计算$操作
                tmp = dollar(chars[pos - 1], chars[pos + 1])
                chars[pos - 1:pos + 2] = [tmp]

    return chars[0]


if __name__ == '__main__':
    assert solve_method("7#6$5#12") == 157
```