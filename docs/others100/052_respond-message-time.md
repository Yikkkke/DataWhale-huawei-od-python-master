# 052 报文响应时间

## 题目描述

IGMP协议中，有一个字段称作最大响应时间（MaxResponseTime），HOST收到查询报文，解析出`MaxResponseTime`字段后，需 要在`(0,MaxResponseTime]`（单位为秒）时间内选取随机时间回应一个响应报文，如果在随机时间内收到一个新的查询报文，则会根据两者时间的大小，选取小的一方刷新回应时间。

最大响应时间有如下计算方式：
- 当`MaxRespCode < 128`时，`MaxRespTime = MaxRespCode`。
- 当`MaxRespCode >= 128`时，`MaxRespTime = (mant | 0x10) << (exp+3)`。 

报文格式如下：

```text
|0| 123 | 4567 |
|1| exp | mant |
```

注：`exp`最大响应时间的高5\~7位，`mant`为最大响应时间的低4位。

其中接收到的`MaxRespCode`最大值为255，以上出现所有字段均为无符号数。现在我们认为HOST接收到查询报文时，选取的随机时间必定为最大值。

现给出HOST收到查询报文个数`C`，HOST收到报文的时间`T`，以及查询报文的最大响应时间字段值`M`，请计算出HOST发送响应报文的时间。

## 输入描述

第一行为查询报文个数`C`。

后续每行分别为HOST收到报文时间`T`，及最大响应字段`M`，以空格分隔。

## 输出描述

HOST发送响应报文的时间

**补充说明：**

用例确定只会发送一个响应报文，不存在计时结束后，依然收到查询报文的情况。

## 示例描述

### 示例一

**输入：**
```text
3
0 20
1 10
8 20
```

**输出描述：**
```text
11
```

**说明**

收到3个报文：

- 第0秒收到第1个报文，响应时间为20秒，则要到0+20=20秒响应。
- 第1秒收到第2个报文，响应时间为10秒；则要到1+10=11秒响应，与上面的报文的响应时间比较，获得响应时间最小为11秒。
- 第8秒收到第3个报文，响应时间为20秒，则要到8+20=28秒响应；与上面的报文的响应时间比较，获得响应时间最小为11秒。
  
最终得到最小响应报文时间为11秒。

### 示例二

**输入：**

```text
2
0 255
200 60
```

**输出：**
```text
260
```
**说明**

收到2个报文：

- 第0秒收到第1个报文，响应时间为255秒，则要到(15| 0x10) << (7+3) = 31744秒响应（mant=15、exp=7）。
- 第200秒收到第2个报文，响应时间为60秒，则要到200+60=260秒响应，与上面的报文的响应时间比较，获得响应时间最小为260秒。

最终得到最小响应报文时间为260秒。

## 解题思路

1. 遍历每个报文的响应：
    - 如果最大响应时间字段值大于等于128，则提取`M`的位4-7，与0x10进行逻辑或操作，然后根据`M`的位0-2值左移。
    - 计算响应时间`T+M`。
    - 比较并得到最小响应时间。
2. 返回结果，即最小的响应时间。    

## 解题代码

```python
import math


def solve_method(N, response_times):
    min_value = math.inf
    for [T, M] in response_times:
        if M >= 128:
            # 提取M的位4-7，与0x10进行逻辑或操作，然后根据M的位0-2值左移
            M = ((M >> 3) & 0xF | 0x10) << (M & 0x7 + 3)
        resp_time = T + M
        if resp_time < min_value:
            min_value = resp_time

    return min_value


if __name__ == '__main__':
    response_times = [[0, 20],
                      [1, 10],
                      [8, 20]]
    assert solve_method(3, response_times) == 11

    response_times = [[0, 255],
                      [200, 60]]
    assert solve_method(2, response_times) == 260
```

