# 026 日志采集系统

## 题目描述

日志采集是运维系统的核心组件。日志是按行生成，每行记作一条，由采集系统分批上报。如果上报太频繁，会对服务端造成压力；如果上报太晚，会降低用户的体验；如果一次上报的条数太多，会导致超时失败。为此，项目组设计了如下的上报策略：
1. 每成功上报一条日志，奖励1分；
2. 每条日志每延迟上报1秒，扣1分；
3. 累积日志达到100条，必须立即上报。

给出日志序列，根据该规则，计算首次上报能获得的最多积分数。

## 输入描述

按时序产生的日志条数$T_1,T_2,\cdots,T_n$，其中$1 \leqslant n \leqslant 1000, 0 \leqslant T_i \leqslant 100$

## 输出描述

首次上报最多能获得的积分数。

## 示例描述

### 示例一

**输入：**
```text
1 98 1
```

**输出：**
```text
98
```

**说明：**  
采集系统第2个时刻上报，可以获得最大积分(98 + 1) - 1 = 98

### 示例二

**输入：**
```text
50 60 1
```

**输出：**
```text
50
```

**说明：**  
- 如果第1个时刻上报，获得积分50。  
- 如果第2个时刻上报，最多上报100条，前50条延迟上报1s，每条扣除1分，共获得积分为100 - 50 = 50。

## 解题思路

1. 当第1个时刻的日志有100条，直接上报，得到100积分。
2. 循环遍历日志序列，并获得最大积分：
    - 当积分没有超过100时，积分=直接上报奖励积分-延迟上报扣分，用`total`保存
    - 当积分超过100时，由于`total`存储了前面的积分，但是在这个时候，前面的日志都延迟了1个时刻，所以变成了延迟上报扣分，积分=100-`total`，返回积分
3. 返回最大积分。

## 解题代码

```python
def calc_score(arr, cur_val):
    score = 0
    # 累计日志条数
    total = 0
    for i in range(cur_val + 1):
        if total + arr[i] < 100:
            # 直接奖励分
            score += arr[i]
            # 延迟上报扣分
            score -= arr[i] * (cur_val - i)
            total += arr[i]
        else:
            # 超过100条，强制上报
            score = 100 - total
            return score

    return score


def solve_method(arr):
    score = 0

    if len(arr) > 0 and arr[0] >= 100:
        return 100

    for i in range(len(arr)):
        score = max(score, calc_score(arr, i))

    return score


if __name__ == '__main__':
    assert solve_method([1, 98, 1]) == 98
    assert solve_method([50, 60, 1]) == 50
```